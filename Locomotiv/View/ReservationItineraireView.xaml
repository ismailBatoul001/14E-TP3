<UserControl x:Class="Locomotiv.View.ReservationItineraireView"
        xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
        xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
        xmlns:d="http://schemas.microsoft.com/expression/blend/2008"
        xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006"
        xmlns:local="clr-namespace:Locomotiv.View"
        mc:Ignorable="d">
    <Grid Margin="20" Background="White">
        <Grid.ColumnDefinitions>
            <ColumnDefinition Width="2*"/>
            <ColumnDefinition Width="10"/>
            <ColumnDefinition Width="*"/>
        </Grid.ColumnDefinitions>

        <ScrollViewer Grid.Column="0" VerticalScrollBarVisibility="Auto" HorizontalScrollBarVisibility="Disabled">
            <Grid>
                <Grid.RowDefinitions>
                    <RowDefinition Height="Auto"/>
                    <RowDefinition Height="*"/>
                    <RowDefinition Height="Auto"/>
                </Grid.RowDefinitions>

                <Border Grid.Row="0" BorderBrush="Gray" BorderThickness="1" Padding="15" Margin="0,0,0,20">
                    <StackPanel>
                        <TextBlock Text="Rechercher un itinéraire" FontWeight="Bold" FontSize="18" Margin="0,0,0,10"/>

                        <TextBlock Text="Station de départ:" Margin="0,5,0,2"/>
                        <ComboBox ItemsSource="{Binding Stations}"
                                  SelectedItem="{Binding StationDepartSelectionnee}"
                                  DisplayMemberPath="Nom"
                                  Padding="5"/>

                        <TextBlock Text="Destination finale:" Margin="0,10,0,2"/>
                        <ComboBox ItemsSource="{Binding Stations}"
                                  SelectedItem="{Binding StationArriveeSelectionnee}"
                                  DisplayMemberPath="Nom"
                                  Padding="5"/>

                        <TextBlock Text="Date de départ:" Margin="0,10,0,2"/>
                        <DatePicker SelectedDate="{Binding DateDepartSelectionnee}" Padding="5"/>

                        <TextBlock Text="Heure de départ souhaitée:" Margin="0,10,0,2"/>
                        <TextBox Text="{Binding HeureDepartSouhaitee, UpdateSourceTrigger=PropertyChanged}" 
                                 Padding="5"
                                 ToolTip="Format: HH:mm (ex: 14:30)"/>

                        <TextBlock Text="Nombre de passagers:" Margin="0,10,0,2"/>
                        <TextBox Text="{Binding NombrePassagers, UpdateSourceTrigger=PropertyChanged}" 
                                 Padding="5"/>

                        <TextBlock Text="{Binding ErrorMessages}"
                                   Margin="0,10,0,0"
                                   TextWrapping="Wrap"/>

                        <Button Content="Rechercher les itinéraires"
                                Command="{Binding RechercherItinerairesCommand}"
                                Margin="0,15,0,0"
                                Padding="10,5"/>
                    </StackPanel>
                </Border>

                <Border Grid.Row="1" BorderBrush="Gray" BorderThickness="1" Padding="10">
                    <Grid>
                        <Grid.RowDefinitions>
                            <RowDefinition Height="Auto"/>
                            <RowDefinition Height="*"/>
                        </Grid.RowDefinitions>

                        <TextBlock Grid.Row="0" 
                                   Text="Itinéraires disponibles (triés par heure de départ)" 
                                   FontWeight="Bold" 
                                   FontSize="16" 
                                   Margin="0,0,0,10"/>

                        <ListBox Grid.Row="1"
                                 ItemsSource="{Binding ItinerairesDisponibles}"
                                 SelectedItem="{Binding ItineraireSelectionne}">
                            <ListBox.ItemTemplate>
                                <DataTemplate>
                                    <Border BorderBrush="LightGray" BorderThickness="1" Margin="5" Padding="10">
                                        <StackPanel>
                                            <Grid>
                                                <Grid.ColumnDefinitions>
                                                    <ColumnDefinition Width="*"/>
                                                    <ColumnDefinition Width="Auto"/>
                                                </Grid.ColumnDefinitions>

                                                <TextBlock Grid.Column="0"
                                                           Text="{Binding Train.Numero, StringFormat='Train {0}'}" 
                                                           FontWeight="Bold" 
                                                           FontSize="14"/>

                                                <TextBlock Grid.Column="1"
                                                           Text="{Binding TarifApproximatif, StringFormat='{}{0:C}'}"
                                                           FontWeight="Bold"/>
                                            </Grid>

                                            <StackPanel Orientation="Horizontal" Margin="0,5,0,0">
                                                <TextBlock Text="{Binding StationDepart.Nom}" FontWeight="Bold"/>
                                                <TextBlock Text=" → " Margin="5,0"/>
                                                <TextBlock Text="{Binding StationArrivee.Nom}" FontWeight="Bold"/>
                                            </StackPanel>

                                            <StackPanel Orientation="Horizontal" Margin="0,5,0,0">
                                                <TextBlock Text="Départ: "/>
                                                <TextBlock Text="{Binding HeureDepart, StringFormat='HH:mm'}" FontWeight="Bold"/>
                                                <TextBlock Text=" | Arrivée: " Margin="10,0,0,0"/>
                                                <TextBlock Text="{Binding HeureArrivee, StringFormat='HH:mm'}" FontWeight="Bold"/>
                                            </StackPanel>

                                            <TextBlock Text="{Binding StationsIntermediaires, StringFormat='Arrêts: {0}'}" 
                                                       Margin="0,5,0,0"
                                                       TextWrapping="Wrap"/>

                                            <StackPanel Orientation="Horizontal" Margin="0,5,0,0">
                                                <TextBlock Text="{Binding PlacesDisponibles, StringFormat='Places disponibles: {0}'}" 
                                                           FontWeight="Bold"/>
                                                <TextBlock Text="{Binding MessageDisponibilite}" 
                                                           Foreground="{Binding CouleurDisponibilite}"
                                                           Margin="10,0,0,0"
                                                           FontStyle="Italic"/>
                                            </StackPanel>
                                        </StackPanel>
                                    </Border>
                                </DataTemplate>
                            </ListBox.ItemTemplate>
                        </ListBox>
                    </Grid>
                </Border>

                <Border Grid.Row="2" BorderBrush="Gray" BorderThickness="1" Padding="15" Margin="0,20,0,0">
                    <StackPanel>
                        <TextBlock Text="Détails de l'itinéraire sélectionné" 
                                   FontWeight="Bold" 
                                   FontSize="16" 
                                   Margin="0,0,0,10"/>

                        <TextBlock Text="{Binding DetailsItineraireSelectionne}" 
                                   TextWrapping="Wrap"
                                   Margin="0,0,0,10"/>

                        <Button Content="Réserver cet itinéraire"
                                Command="{Binding ReserverItineraireCommand}"
                                Padding="10,5"
                                FontWeight="Bold"/>
                    </StackPanel>
                </Border>
            </Grid>
        </ScrollViewer>

        <GridSplitter Grid.Column="1" 
                      Width="10" 
                      HorizontalAlignment="Stretch" 
                      Background="LightGray"/>

        <ScrollViewer Grid.Column="2" VerticalScrollBarVisibility="Auto" HorizontalScrollBarVisibility="Disabled">
            <Grid>
                <Grid.RowDefinitions>
                    <RowDefinition Height="Auto"/>
                    <RowDefinition Height="*"/>
                    <RowDefinition Height="Auto"/>
                </Grid.RowDefinitions>

                <Border Grid.Row="0" BorderBrush="Gray" BorderThickness="1" Padding="15" Margin="0,0,0,20">
                    <StackPanel>
                        <TextBlock Text="Mes réservations" FontWeight="Bold" FontSize="18" Margin="0,0,0,10"/>

                        <TextBlock Text="Filtrer par statut:" Margin="0,5,0,2"/>
                        <ComboBox ItemsSource="{Binding Source={StaticResource StatutReservationValues}}"
                                  SelectedItem="{Binding StatutFiltre}"
                                  Padding="5"/>

                        <Button Content="Rafraîchir"
                                Command="{Binding RafraichirReservationsCommand}"
                                Margin="0,10,0,0"
                                Padding="10,5"/>
                    </StackPanel>
                </Border>

                <Border Grid.Row="1" BorderBrush="Gray" BorderThickness="1" Padding="10">
                    <ListBox ItemsSource="{Binding MesReservations}"
                             SelectedItem="{Binding ReservationSelectionnee}">
                        <ListBox.ItemTemplate>
                            <DataTemplate>
                                <Border BorderBrush="LightGray" BorderThickness="1" Margin="5" Padding="10">
                                    <StackPanel>
                                        <TextBlock Text="{Binding NumeroBillet, StringFormat='Billet: {0}'}" 
                                                   FontWeight="Bold" 
                                                   FontSize="12"/>

                                        <TextBlock Text="{Binding Statut, StringFormat='Statut: {0}'}"
                                                   Margin="0,3,0,0"
                                                   FontSize="11"/>

                                        <TextBlock Text="{Binding MontantTotal, StringFormat='{}{0:C}'}"
                                                   FontWeight="Bold"
                                                   FontSize="14"
                                                   Margin="0,5,0,0"/>

                                        <TextBlock Text="{Binding Itineraire.Train.Numero, StringFormat='Train: {0}'}" 
                                                   Margin="0,5,0,0"
                                                   FontSize="11"/>

                                        <StackPanel Orientation="Horizontal" Margin="0,3,0,0">
                                            <TextBlock Text="{Binding Itineraire.StationDepart.Nom}" 
                                                       FontSize="10"
                                                       FontWeight="Bold"/>
                                            <TextBlock Text=" → " Margin="2,0" FontSize="10"/>
                                            <TextBlock Text="{Binding Itineraire.StationArrivee.Nom}" 
                                                       FontSize="10"
                                                       FontWeight="Bold"/>
                                        </StackPanel>

                                        <TextBlock Text="{Binding Itineraire.DateCreation, StringFormat='Départ: {0:dd/MM HH:mm}'}"
                                                   Margin="0,3,0,0"
                                                   FontSize="10"/>

                                        <TextBlock Text="{Binding NombrePassagers, StringFormat='{}{0} passager(s)'}"
                                                   Margin="0,3,0,0"
                                                   FontSize="10"/>
                                    </StackPanel>
                                </Border>
                            </DataTemplate>
                        </ListBox.ItemTemplate>
                    </ListBox>
                </Border>

                <Border Grid.Row="2" BorderBrush="Gray" BorderThickness="1" Padding="10" Margin="0,20,0,0">
                    <StackPanel>
                        <Button Content="Voir détails"
                                Command="{Binding VoirDetailsReservationCommand}"
                                Padding="8,5"
                                Margin="0,0,0,5"/>

                        <Button Content="Annuler"
                                Command="{Binding AnnulerReservationCommand}"
                                Padding="8,5"/>
                    </StackPanel>
                </Border>
            </Grid>
        </ScrollViewer>
    </Grid>
</UserControl>